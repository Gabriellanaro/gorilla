<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Function Calling Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f3f6ff;
      --panel: #ffffff;
      --border: #d7e3ff;
      --text: #1d2b4f;
      --muted: #5b6b8a;
      --cell: #c8d7ff;
      --best: #7ef07b;
      --baseline: #bcd0ff;
    }
    body {
      margin: 0;
      background: linear-gradient(135deg, #f0f5ff, #e5efff);
      color: var(--text);
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    .wrap {
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      margin: 0 0 12px;
      font-size: 24px;
      font-weight: 700;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      background: var(--panel);
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 10px;
      box-shadow: 0 6px 16px rgba(23, 51, 94, 0.08);
      margin-bottom: 16px;
    }
    .controls label {
      font-size: 13px;
      color: var(--muted);
    }
    select, button {
      margin-left: 6px;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: #f8fbff;
      color: var(--text);
      font-size: 13px;
    }
    button {
      cursor: pointer;
    }
    .filter {
      min-width: 200px;
    }
    .model-filter {
      width: 220px;
      min-height: 120px;
    }
    .sortable {
      cursor: pointer;
      user-select: none;
    }
    .sortable:hover {
      text-decoration: underline;
      background: #eef3ff;
    }
    .overall-header {
      background: #e2e6ef;
      font-weight: 700;
    }
    .sort-indicator {
      margin-left: 6px;
      font-size: 11px;
      color: var(--muted);
    }
    .note {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 10px;
    }
    .section {
      margin-top: 24px;
    }
    .section h2 {
      margin: 16px 0 8px;
      font-size: 18px;
    }
    .section .note {
      margin-top: 0;
    }
    .table-wrap {
      overflow: auto;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--panel);
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 760px;
    }
    thead th {
      position: sticky;
      top: 0;
      background: #f9fbff;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--muted);
      padding: 10px;
      text-align: center;
    }
    tbody td {
      padding: 12px 10px;
      text-align: center;
      background: var(--cell);
      border-bottom: 1px solid #e6ecff;
      border-right: 1px solid #e6ecff;
      font-size: 14px;
    }
    tbody td:first-child {
      text-align: left;
      background: #f2f6ff;
      font-weight: 600;
      color: #15307a;
    }
    tbody td.baseline {
      background: var(--baseline);
      font-weight: 600;
    }
    tbody td.best {
      background: var(--best);
      font-weight: 700;
      color: #0c3a0c;
    }
    tbody tr:last-child td {
      border-bottom: none;
    }
    tbody td:last-child, thead th:last-child {
      border-right: none;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>OpenFunctions Leaderboard</h1>
    <div class="controls">
      <label>Delta format
        <select id="deltaMode">
          <option value="pp">pp</option>
          <option value="rel">relative%</option>
        </select>
      </label>
      <label>Table
        <select id="tableSelect"></select>
      </label>
      <label class="filter">Models
        <select id="modelFilter" class="model-filter" multiple></select>
      </label>
      <button id="selectAllModels">All</button>
      <button id="clearModels">None</button>
    </div>
    <div class="note" id="note">Missing data for conditions: OA. Showing available results.</div>
    <div class="table-wrap">
      <table data-table-key="main">
        <thead>
          <tr>
            <th>Model</th>
            <th>OO</th>
            <th>OA</th>
            <th>AO</th>
            <th>AA</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
    <div id="detailSections"></div>
  </div>
  <script>
    const MISSING = "--";
    const mainRows = [{"model": "Azure gpt-4o (FC)", "OO": 48.47, "OA": null, "AO": 50.38, "AA": 48.35, "bestAcc": 50.38}, {"model": "Azure gpt-5-mini (FC)", "OO": 7.3, "OA": null, "AO": null, "AA": null, "bestAcc": 7.3}, {"model": "Azure gpt-5.1-responses (FC)", "OO": 41.15, "OA": null, "AO": 49.11, "AA": 43.61, "bestAcc": 49.11}];
    const categoryTables = [{"key": "data_agentic", "title": "Agentic", "metrics": ["Agentic Overall Acc", "Web Search Summary", "Web Search Base", "Web Search No Snippet", "Memory Summary", "Memory KV", "Memory Vector", "Memory Recursive Summarization"], "rows": [{"model": "Azure gpt-4o (FC)", "metrics": {"Agentic Overall Acc": {"OO": 30.15, "OA": null, "AO": 35.09, "AA": 28.56}, "Web Search Summary": {"OO": 39.0, "OA": null, "AO": 42.0, "AA": 25.5}, "Web Search Base": {"OO": 39.0, "OA": null, "AO": 43.0, "AA": 39.0}, "Web Search No Snippet": {"OO": 39.0, "OA": null, "AO": 41.0, "AA": 12.0}, "Memory Summary": {"OO": 21.29, "OA": null, "AO": 28.17, "AA": 31.61}, "Memory KV": {"OO": 14.19, "OA": null, "AO": 17.42, "AA": 20.0}, "Memory Vector": {"OO": 16.77, "OA": null, "AO": 23.87, "AA": 21.94}, "Memory Recursive Summarization": {"OO": 32.9, "OA": null, "AO": 43.23, "AA": 52.9}}}, {"model": "Azure gpt-5-mini (FC)", "metrics": {"Agentic Overall Acc": {"OO": 18.25, "OA": null, "AO": null, "AA": null}, "Web Search Summary": {"OO": null, "OA": null, "AO": null, "AA": null}, "Web Search Base": {"OO": 73.0, "OA": null, "AO": null, "AA": null}, "Web Search No Snippet": {"OO": null, "OA": null, "AO": null, "AA": null}, "Memory Summary": {"OO": null, "OA": null, "AO": null, "AA": null}, "Memory KV": {"OO": null, "OA": null, "AO": null, "AA": null}, "Memory Vector": {"OO": null, "OA": null, "AO": null, "AA": null}, "Memory Recursive Summarization": {"OO": null, "OA": null, "AO": null, "AA": null}}}, {"model": "Azure gpt-5.1-responses (FC)", "metrics": {"Agentic Overall Acc": {"OO": 21.12, "OA": null, "AO": 43.13, "AA": 30.49}, "Web Search Summary": {"OO": 16.0, "OA": null, "AO": 51.0, "AA": 28.5}, "Web Search Base": {"OO": 16.0, "OA": null, "AO": 55.0, "AA": 42.0}, "Web Search No Snippet": {"OO": 16.0, "OA": null, "AO": 47.0, "AA": 15.0}, "Memory Summary": {"OO": 26.24, "OA": null, "AO": 35.27, "AA": 32.47}, "Memory KV": {"OO": 16.13, "OA": null, "AO": 25.16, "AA": 13.55}, "Memory Vector": {"OO": 16.77, "OA": null, "AO": 19.35, "AA": 21.29}, "Memory Recursive Summarization": {"OO": 45.81, "OA": null, "AO": 61.29, "AA": 62.58}}}], "missing": ["OA"]}, {"key": "data_live", "title": "Live", "metrics": ["Live Overall Acc", "AST Summary", "Python Simple AST", "Python Multiple AST", "Python Parallel AST", "Python Parallel Multiple AST", "Irrelevance Detection", "Relevance Detection"], "rows": [{"model": "Azure gpt-4o (FC)", "metrics": {"Live Overall Acc": {"OO": 70.1, "OA": null, "AO": 67.8, "AA": 68.1}, "AST Summary": {"OO": 70.1, "OA": null, "AO": 67.8, "AA": 68.1}, "Python Simple AST": {"OO": 70.93, "OA": null, "AO": 66.67, "AA": 68.22}, "Python Multiple AST": {"OO": 70.09, "OA": null, "AO": 68.0, "AA": 68.09}, "Python Parallel AST": {"OO": 62.5, "OA": null, "AO": 75.0, "AA": 68.75}, "Python Parallel Multiple AST": {"OO": 66.67, "OA": null, "AO": 66.67, "AA": 66.67}, "Irrelevance Detection": {"OO": 79.41, "OA": null, "AO": 81.33, "AA": 81.22}, "Relevance Detection": {"OO": 87.5, "OA": null, "AO": 81.25, "AA": 75.0}}}, {"model": "Azure gpt-5-mini (FC)", "metrics": {"Live Overall Acc": {"OO": 0.0, "OA": null, "AO": null, "AA": null}, "AST Summary": {"OO": null, "OA": null, "AO": null, "AA": null}, "Python Simple AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "Python Multiple AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "Python Parallel AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "Python Parallel Multiple AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "Irrelevance Detection": {"OO": null, "OA": null, "AO": null, "AA": null}, "Relevance Detection": {"OO": null, "OA": null, "AO": null, "AA": null}}}, {"model": "Azure gpt-5.1-responses (FC)", "metrics": {"Live Overall Acc": {"OO": 63.8, "OA": null, "AO": 61.81, "AA": 60.03}, "AST Summary": {"OO": 63.8, "OA": null, "AO": 61.81, "AA": 60.03}, "Python Simple AST": {"OO": 66.67, "OA": null, "AO": 59.69, "AA": 56.2}, "Python Multiple AST": {"OO": 63.15, "OA": null, "AO": 62.2, "AA": 60.87}, "Python Parallel AST": {"OO": 56.25, "OA": null, "AO": 68.75, "AA": 68.75}, "Python Parallel Multiple AST": {"OO": 66.67, "OA": null, "AO": 62.5, "AA": 58.33}, "Irrelevance Detection": {"OO": 84.39, "OA": null, "AO": 87.67, "AA": 86.65}, "Relevance Detection": {"OO": 68.75, "OA": null, "AO": 75.0, "AA": 75.0}}}], "missing": ["OA"]}, {"key": "data_multi_turn", "title": "Multi Turn", "metrics": ["Multi Turn Overall Acc", "Base", "Miss Func", "Miss Param", "Long Context"], "rows": [{"model": "Azure gpt-4o (FC)", "metrics": {"Multi Turn Overall Acc": {"OO": 42.38, "OA": null, "AO": 42.12, "AA": 44.62}, "Base": {"OO": 53.5, "OA": null, "AO": 53.0, "AA": 56.0}, "Miss Func": {"OO": 33.5, "OA": null, "AO": 32.5, "AA": 34.5}, "Miss Param": {"OO": 34.0, "OA": null, "AO": 34.5, "AA": 37.0}, "Long Context": {"OO": 48.5, "OA": null, "AO": 48.5, "AA": 51.0}}}, {"model": "Azure gpt-5-mini (FC)", "metrics": {"Multi Turn Overall Acc": {"OO": 0.0, "OA": null, "AO": null, "AA": null}, "Base": {"OO": null, "OA": null, "AO": null, "AA": null}, "Miss Func": {"OO": null, "OA": null, "AO": null, "AA": null}, "Miss Param": {"OO": null, "OA": null, "AO": null, "AA": null}, "Long Context": {"OO": null, "OA": null, "AO": null, "AA": null}}}, {"model": "Azure gpt-5.1-responses (FC)", "metrics": {"Multi Turn Overall Acc": {"OO": 31.63, "OA": null, "AO": 29.25, "AA": 29.62}, "Base": {"OO": 38.0, "OA": null, "AO": 35.5, "AA": 38.5}, "Miss Func": {"OO": 28.5, "OA": null, "AO": 28.5, "AA": 25.0}, "Miss Param": {"OO": 26.0, "OA": null, "AO": 24.5, "AA": 24.0}, "Long Context": {"OO": 34.0, "OA": null, "AO": 28.5, "AA": 31.0}}}], "missing": ["OA"]}, {"key": "data_non_live", "title": "Non Live", "metrics": ["Non-Live Overall Acc", "AST Summary", "Simple AST", "Python Simple AST", "Java Simple AST", "JavaScript Simple AST", "Multiple AST", "Parallel AST", "Parallel Multiple AST", "Irrelevance Detection"], "rows": [{"model": "Azure gpt-4o (FC)", "metrics": {"Non-Live Overall Acc": {"OO": 84.67, "OA": null, "AO": 83.19, "AA": 83.79}, "AST Summary": {"OO": 84.67, "OA": null, "AO": 83.19, "AA": 83.79}, "Simple AST": {"OO": 76.67, "OA": null, "AO": 74.25, "AA": 74.67}, "Python Simple AST": {"OO": 90.0, "OA": null, "AO": 86.75, "AA": 87.0}, "Java Simple AST": {"OO": 66.0, "OA": null, "AO": 66.0, "AA": 65.0}, "JavaScript Simple AST": {"OO": 74.0, "OA": null, "AO": 70.0, "AA": 72.0}, "Multiple AST": {"OO": 91.5, "OA": null, "AO": 88.5, "AA": 88.5}, "Parallel AST": {"OO": 90.5, "OA": null, "AO": 91.0, "AA": 92.0}, "Parallel Multiple AST": {"OO": 80.0, "OA": null, "AO": 79.0, "AA": 80.0}, "Irrelevance Detection": {"OO": 85.0, "OA": null, "AO": 90.83, "AA": 85.83}}}, {"model": "Azure gpt-5-mini (FC)", "metrics": {"Non-Live Overall Acc": {"OO": 0.0, "OA": null, "AO": null, "AA": null}, "AST Summary": {"OO": null, "OA": null, "AO": null, "AA": null}, "Simple AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "Python Simple AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "Java Simple AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "JavaScript Simple AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "Multiple AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "Parallel AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "Parallel Multiple AST": {"OO": null, "OA": null, "AO": null, "AA": null}, "Irrelevance Detection": {"OO": null, "OA": null, "AO": null, "AA": null}}}, {"model": "Azure gpt-5.1-responses (FC)", "metrics": {"Non-Live Overall Acc": {"OO": 81.81, "OA": null, "AO": 79.1, "AA": 77.56}, "AST Summary": {"OO": 81.81, "OA": null, "AO": 79.1, "AA": 77.56}, "Simple AST": {"OO": 72.25, "OA": null, "AO": 73.42, "AA": 69.75}, "Python Simple AST": {"OO": 87.75, "OA": null, "AO": 84.25, "AA": 82.25}, "Java Simple AST": {"OO": 63.0, "OA": null, "AO": 64.0, "AA": 63.0}, "JavaScript Simple AST": {"OO": 66.0, "OA": null, "AO": 72.0, "AA": 64.0}, "Multiple AST": {"OO": 88.5, "OA": null, "AO": 86.0, "AA": 82.5}, "Parallel AST": {"OO": 86.5, "OA": null, "AO": 82.5, "AA": 80.5}, "Parallel Multiple AST": {"OO": 80.0, "OA": null, "AO": 74.5, "AA": 77.5}, "Irrelevance Detection": {"OO": 88.75, "OA": null, "AO": 92.08, "AA": 88.75}}}], "missing": ["OA"]}];
    const allModels = ["Azure gpt-4o (FC)", "Azure gpt-5-mini (FC)", "Azure gpt-5.1-responses (FC)"];
    const conditions = ["OO", "OA", "AO", "AA"];
    const tableState = {};

    function isNumber(value) {
      return typeof value === "number" && !Number.isNaN(value);
    }

    function toFixed(value, digits) {
      return isNumber(value) ? value.toFixed(digits) : MISSING;
    }

    function formatDelta(acc, baseline, mode) {
      if (!isNumber(acc) || !isNumber(baseline)) {
        return MISSING;
      }
      if (mode === "rel") {
        if (baseline === 0) {
          return MISSING;
        }
        const rel = ((acc - baseline) / baseline) * 100;
        return (rel >= 0 ? "+" : "") + rel.toFixed(2) + "%";
      }
      const delta = acc - baseline;
      return (delta >= 0 ? "+" : "") + delta.toFixed(2);
    }

    function buildTableSelect() {
      const select = document.getElementById("tableSelect");
      select.innerHTML = "";
      const mainOption = document.createElement("option");
      mainOption.value = "main";
      mainOption.textContent = "Main";
      select.appendChild(mainOption);
      const allOption = document.createElement("option");
      allOption.value = "all";
      allOption.textContent = "All";
      select.appendChild(allOption);
      categoryTables.forEach((table) => {
        const option = document.createElement("option");
        option.value = table.key;
        option.textContent = table.title;
        select.appendChild(option);
      });
      select.value = "main";
    }

    function buildModelFilter() {
      const select = document.getElementById("modelFilter");
      select.innerHTML = "";
      allModels.forEach((model) => {
        const option = document.createElement("option");
        option.value = model;
        option.textContent = model;
        option.selected = true;
        select.appendChild(option);
      });
    }

    function getSelectedModels() {
      const select = document.getElementById("modelFilter");
      const values = Array.from(select.selectedOptions).map((option) => option.value);
      if (values.length === 0) {
        return new Set(allModels);
      }
      return new Set(values);
    }

    function renderMainTable() {
      const body = document.getElementById("tableBody");
      const mode = document.getElementById("deltaMode").value;
      const selected = getSelectedModels();
      body.innerHTML = "";
      const tableKey = "main";
      const sortedRows = getSortedRows(tableKey, mainRows);
      sortedRows.forEach((row) => {
        if (!selected.has(row.model)) {
          return;
        }
        const tr = document.createElement("tr");
        const baseline = row.OO;
        const bestAcc = row.bestAcc;

        function buildCell(label, value, isBaseline, condition) {
          const td = document.createElement("td");
          if (label === "Model") {
            td.textContent = value ?? MISSING;
            return td;
          }
          const accText = toFixed(value, 2);
          if (condition === "OO") {
            td.textContent = accText;
          } else {
            const deltaText = formatDelta(value, baseline, mode);
            td.textContent = accText + " (" + deltaText + ")";
          }
          if (isBaseline) {
            td.classList.add("baseline");
          }
          if (isNumber(value) && isNumber(bestAcc) && value === bestAcc) {
            td.classList.add("best");
          }
          return td;
        }

        tr.appendChild(buildCell("Model", row.model, false, "Model"));
        tr.appendChild(buildCell("OO", row.OO, true, "OO"));
        tr.appendChild(buildCell("OA", row.OA, false, "OA"));
        tr.appendChild(buildCell("AO", row.AO, false, "AO"));
        tr.appendChild(buildCell("AA", row.AA, false, "AA"));
        body.appendChild(tr);
      });
    }

    function getSortValueMain(row, key, mode) {
      if (key === "model") {
        return row.model ? row.model.toLowerCase() : "";
      }
      if (key.endsWith("_delta")) {
        const condition = key.split("_")[0];
        if (condition === "OO") {
          return 0;
        }
        const acc = row[condition];
        const baseline = row.OO;
        if (!isNumber(acc) || !isNumber(baseline)) {
          return Number.NEGATIVE_INFINITY;
        }
        if (mode === "rel") {
          return baseline === 0 ? Number.NEGATIVE_INFINITY : ((acc - baseline) / baseline) * 100;
        }
        return acc - baseline;
      }
      const value = row[key];
      if (isNumber(value)) {
        return value;
      }
      return Number.NEGATIVE_INFINITY;
    }

    function getSortValueDetail(row, sortSpec) {
      if (sortSpec.key === "model") {
        return row.model ? row.model.toLowerCase() : "";
      }
      const metric = sortSpec.metric;
      const condition = sortSpec.condition;
      const metricValues = row.metrics[metric] || {};
      const value = metricValues[condition];
      if (isNumber(value)) {
        return value;
      }
      return Number.NEGATIVE_INFINITY;
    }

    function getSortedRows(tableKey, rows) {
      const mode = document.getElementById("deltaMode").value;
      const state = tableState[tableKey];
      const sortKey = state ? state.sortKey : null;
      const sortDir = state ? state.sortDir : null;
      const multiplier = sortDir === "asc" ? 1 : -1;
      const sortSpec = sortKey ? buildSortSpec(tableKey, sortKey) : null;
      const sorted = rows.slice();
      sorted.sort((a, b) => {
        let av;
        let bv;
        if (sortKey) {
          if (tableKey === "main") {
            av = getSortValueMain(a, sortKey, mode);
            bv = getSortValueMain(b, sortKey, mode);
          } else {
            av = getSortValueDetail(a, sortSpec);
            bv = getSortValueDetail(b, sortSpec);
          }
          if (av > bv) return 1 * multiplier;
          if (av < bv) return -1 * multiplier;
        }
        return a.model.localeCompare(b.model);
      });
      return sorted;
    }

    function buildSortSpec(tableKey, sortKey) {
      if (tableKey === "main") {
        return { key: sortKey };
      }
      const [metric, condition] = sortKey.split("::");
      return { key: sortKey, metric, condition };
    }

    function renderDetailTables() {
      const container = document.getElementById("detailSections");
      const mode = document.getElementById("deltaMode").value;
      const selected = getSelectedModels();
      const selectedTable = document.getElementById("tableSelect").value;
      container.innerHTML = "";
      categoryTables.forEach((table) => {
        if (selectedTable !== "all" && selectedTable !== table.key) {
          return;
        }
        const section = document.createElement("div");
        section.className = "section";
        section.id = `section-${table.key}`;

        const heading = document.createElement("h2");
        heading.textContent = table.title;
        section.appendChild(heading);

        if (table.missing && table.missing.length) {
          const note = document.createElement("div");
          note.className = "note";
          note.textContent = `Missing data for conditions: ${table.missing.join(", ")}. Showing available results.`;
          section.appendChild(note);
        }

        const wrap = document.createElement("div");
        wrap.className = "table-wrap";
        const tableEl = document.createElement("table");
        tableEl.dataset.tableKey = table.key;

        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");
        const modelTh = document.createElement("th");
        modelTh.textContent = "Model";
        modelTh.classList.add("sortable");
        modelTh.dataset.sortKey = "model";
        headerRow.appendChild(modelTh);
        table.metrics.forEach((metric) => {
          const isOverall = metric.toLowerCase().includes("overall");
          conditions.forEach((condition) => {
            const th = document.createElement("th");
            th.classList.add("sortable");
            th.dataset.sortKey = `${metric}::${condition}`;
            th.textContent = `${metric} ${condition}`;
            if (isOverall) {
              th.classList.add("overall-header");
            }
            headerRow.appendChild(th);
          });
        });
        thead.appendChild(headerRow);
        tableEl.appendChild(thead);

        const tbody = document.createElement("tbody");
        const tableKey = table.key;
        const sortedRows = getSortedRows(tableKey, table.rows);
        sortedRows.forEach((row) => {
          if (!selected.has(row.model)) {
            return;
          }
          const tr = document.createElement("tr");
          const modelTd = document.createElement("td");
          modelTd.textContent = row.model ?? MISSING;
          tr.appendChild(modelTd);
          table.metrics.forEach((metric) => {
            const metricValues = row.metrics[metric] || {};
            const bestAcc = Math.max(
              ...conditions
                .map((condition) => metricValues[condition])
                .filter((value) => isNumber(value))
            );
            conditions.forEach((condition) => {
              const value = metricValues[condition];
              const td = document.createElement("td");
              const baseline = metricValues["OO"];
              const accText = toFixed(value, 2);
              if (condition === "OO") {
                td.textContent = accText;
                td.classList.add("baseline");
              } else {
                const deltaText = formatDelta(value, baseline, mode);
                td.textContent = accText + " (" + deltaText + ")";
              }
              if (isNumber(value) && isNumber(bestAcc) && value === bestAcc) {
                td.classList.add("best");
              }
              tr.appendChild(td);
            });
          });
          tbody.appendChild(tr);
        });
        tableEl.appendChild(tbody);
        wrap.appendChild(tableEl);
        section.appendChild(wrap);
        container.appendChild(section);
        updateSortIndicators(tableEl, table.key);
      });
    }

    function renderAllTables() {
      const selectedTable = document.getElementById("tableSelect").value;
      const mainSection = document.querySelector(".table-wrap");
      const note = document.getElementById("note");
      if (selectedTable === "main" || selectedTable === "all") {
        mainSection.style.display = "";
        note.style.display = "";
        renderMainTable();
        const mainTable = document.querySelector("table[data-table-key='main']");
        if (mainTable) {
          updateSortIndicators(mainTable, "main");
        }
      } else {
        mainSection.style.display = "none";
        note.style.display = "none";
      }
      renderDetailTables();
    }

    function bindControls() {
      document.getElementById("deltaMode").addEventListener("change", () => {
        renderAllTables();
        attachHeaderSorting();
      });
      document.getElementById("tableSelect").addEventListener("change", (event) => {
        renderAllTables();
        attachHeaderSorting();
      });
      document.getElementById("modelFilter").addEventListener("change", () => {
        renderAllTables();
        attachHeaderSorting();
      });
      document.getElementById("selectAllModels").addEventListener("click", () => {
        const select = document.getElementById("modelFilter");
        Array.from(select.options).forEach((option) => {
          option.selected = true;
        });
        renderAllTables();
        attachHeaderSorting();
      });
      document.getElementById("clearModels").addEventListener("click", () => {
        const select = document.getElementById("modelFilter");
        Array.from(select.options).forEach((option) => {
          option.selected = false;
        });
        renderAllTables();
        attachHeaderSorting();
      });
    }

    function updateSortIndicators(tableElement, tableKey) {
      const state = tableState[tableKey] || { sortKey: null, sortDir: null };
      tableElement.querySelectorAll("th.sortable").forEach((th) => {
        const indicator = th.querySelector(".sort-indicator");
        if (indicator) {
          indicator.remove();
        }
        if (state.sortKey && th.dataset.sortKey === state.sortKey) {
          const span = document.createElement("span");
          span.className = "sort-indicator";
          span.textContent = state.sortDir === "asc" ? "▲" : "▼";
          th.appendChild(span);
        }
      });
    }

    function attachHeaderSorting() {
      document.querySelectorAll("table").forEach((table) => {
        table.querySelectorAll("th.sortable").forEach((th) => {
          if (th.dataset.bound === "1") {
            return;
          }
          th.dataset.bound = "1";
          th.addEventListener("click", () => {
            const tableKey = table.dataset.tableKey || "main";
            const key = th.dataset.sortKey;
            const state = tableState[tableKey] || { sortKey: null, sortDir: null };
            if (state.sortKey !== key) {
              state.sortKey = key;
              state.sortDir = "asc";
            } else if (state.sortDir === "asc") {
              state.sortDir = "desc";
            } else {
              state.sortKey = null;
              state.sortDir = null;
            }
            tableState[tableKey] = state;
            renderAllTables();
            attachHeaderSorting();
          });
        });
      });
    }

    function renderMainHeader() {
      const headerRow = document.querySelector("table thead tr");
      if (!headerRow) {
        return;
      }
      headerRow.querySelectorAll("th").forEach((th, index) => {
        if (index === 0) {
          th.classList.add("sortable");
          th.dataset.sortKey = "model";
        } else {
          const condition = conditions[index - 1];
          th.classList.add("sortable");
          th.dataset.sortKey = condition;
        }
      });
    }

    function renderAllTablesWithHeaders() {
      renderMainHeader();
      renderAllTables();
      attachHeaderSorting();
    }

    buildTableSelect();
    buildModelFilter();
    tableState["main"] = { sortKey: null, sortDir: null };
    categoryTables.forEach((table) => {
      tableState[table.key] = { sortKey: null, sortDir: null };
    });
    bindControls();
    renderAllTablesWithHeaders();
  </script>
</body>
</html>
